import socket
import os
import sys

def retBanner(ip,port):
    try:
        socket.setdefaulttimeout(2)
        s=socket.socket()
        s.connect((ip,port))
        banner = s.recv(1024)
        return banner
    except:
        return

def CheckVulns(banner,filename):
    f=open(filename,"r")
    ## METHOD1 WHICH IS OF ENCODING WORKS FOR ALL VULNERABLE PORTS
    for line in f.readlines():
        try:
            if line.strip("\n").encode('ascii') in banner:
                print('server is vulnerable',banner)

        except Exception as e:
            print(f'ERROR:{e}')
    ## METHOD2 WHICH IS OF DECODING WORKS FOR SOME VULNERABLE PORTS
    # for line in f.readlines():
    #     try:
    #         if line.strip("\n") in banner.decode('UTF-8'):
    #             print('server is vulnerable',banner)
    #         elif line.strip("\n") in banner.decode('UTF-16'):
    #             print('server is vulnerable',banner)
    #     except Exception as e:
    #         print(f'ERROR:{e}')





def main():
    if len(sys.argv)==2:
        filename= sys.argv[1]
        if not os.path.isfile(filename):
            print(filename,'File doent exist')
            exit(0)
        if not os.access(filename,os.R_OK):
            print(filename,'Access Denied')
            exit(0)
    else:
        print('Usage',str(sys.argv[0]),'<vuln  filename>')
        exit(0)

    portlist = [21,22,23,24,25,80,110,443,445]
    for x in range(250,254):
        ip='192.168.43.'+str(x)
        for port in portlist:
            banner = retBanner(ip,port)
            if banner:
                print(ip,'/',str(port),banner)
                CheckVulns(banner,filename)
main()













